## Windows Excel Runner — рекомендации (чеклист)

Цель runner’а в текущем VBA: **массово вставить/обновить логотип/печать/подписи на листах** по конфигу.

Источник: `extracted_vba/modules/Module1.bas`, события из `extracted_vba/classes/Лист3.cls`, имена листов — `extracted_vba/workbook_map.md`.

### A) Что заполнить на листе `ввод данных` до запуска

По требованиям процесса (вводные поля, которые вы перечислили):

- `C2, C3, C4, C5, C6, C7, B8, C11, C15, C16, C17, C20` (и `C18`, если нужно)

По факту извлечённого VBA **напрямую читается** только одно поле:

- **`ввод данных`!`B11`** — `companyName` (название компании)
  - значение должно **точно совпадать** (без лишних пробелов) с названием компании в `компании`!A (колонка 1), иначе картинки не вставятся.

Рекомендация для runner’а:

- Заполнить все ваши поля на `ввод данных`, затем явно установить `B11` (или в конце ещё раз “потрогать” `B11`), и только потом запускать макрос.

### B) Какой макрос запускать

**Запускать напрямую (рекомендуется):**

- `Module1.UpdateAllStampsFromConfig`

Почему именно он:

- Это верхний уровень логики: читает `Конфиг`, для каждого листа подтягивает пути из `компании` по `ввод данных`!B11 и вставляет картинки.

**Не использовать как entrypoint (только события):**

- `Лист3.Worksheet_Change / Worksheet_Calculate / Worksheet_Activate` — они лишь триггерят `UpdateAllStampsFromConfig` автоматически.

### C) Какие настройки Excel выставить в runner’е

Рекомендуемый “тихий” профиль (чтобы избежать лишних событий/мигания/диалогов):

- `Application.DisplayAlerts = False`
- `Application.ScreenUpdating = False`
- `Application.EnableEvents = False` (на время заполнения данных)
- `Application.Calculation = xlCalculationManual` на время заполнения
  - после заполнения: `Application.CalculateFull` (или `CalculateFullRebuild`, если нужно)
  - перед запуском макроса можно вернуть `xlCalculationAutomatic` (не обязательно)

Важно:

- В книге есть обработчики событий на листе `Лист3` (см. `extracted_vba/classes/Лист3.cls`), которые вызывают `UpdateAllStampsFromConfig` при `Calculate/Activate/Change`. Поэтому для стабильности лучше держать события выключенными и запускать макрос явно.

### D) Как организовать файловую систему (картинки)

VBA не генерирует картинки и не встраивает их из ресурсов — оно **читает пути с листа `компании`** и проверяет наличие файла через `Dir(path)`.

Runner должен обеспечить:

1) **Локальные файлы на диске** (рекомендуется абсолютный путь), например:

- `C:\work\visa-assets\logo.png`
- `C:\work\visa-assets\stamp.png`
- `C:\work\visa-assets\sign_director.png`
- `C:\work\visa-assets\sign_client.png`

2) На листе `компании` (точное имя листа из `workbook_map.md`) в строке нужной компании:

- колонка D (4): путь к печати
- колонка E (5): путь к логотипу
- колонка F (6): путь к подписи директора
- колонка G (7): путь к подписи клиента

3) На листе `Конфиг`:

- колонка A: имя листа, куда вставлять (должно совпадать с именем вкладки из `workbook_map.md`)
- колонки B/D/F/H: TRUE/FALSE (вставлять ли конкретный тип картинки)
- колонки C/E/G/I: адреса ячеек-якорей (например `B2`)

### E) Что runner должен ожидать на выходе

После `Module1.UpdateAllStampsFromConfig`:

- На листах, перечисленных в `Конфиг`, будут удалены все картинки (`msoPicture`) и вставлены новые картинки в указанные якорные ячейки (если файлы существуют).
- В извлечённом VBA **нет** PDF‑экспорта (`ExportAsFixedFormat` отсутствует), поэтому PDF нужно делать отдельным шагом runner’а (через COM‑вызов `ExportAsFixedFormat` на workbook/worksheet).

